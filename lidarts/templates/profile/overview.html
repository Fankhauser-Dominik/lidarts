{% extends "base.html" %}

{% block app_content %}


<div class="row justify-content-between">
    <div class="col-auto mb-3">
        <div class="card bg-light text-dark">
            <div class="card-body">
                <h3 class="card-text">
                    <img src="{{ avatar_url }}" height="60px" width="60px" class="avatar border">
                    <i class="fas {% if user.is_backer %}fa-star{% else %}fa-circle{% endif %} {% if recently_online %}status-{{ user.status }}" title="User is {{ user.status }}"{% else %}text-secondary" title="User is offline"{% endif %} style="font-size: 20px;"></i>
                    {{ user.username }} {% if user.id in friend_list %}<i class="fas fa-user-friends" title="User is your friend."></i>{% endif %}
                    {% if country %}<img src="/static/img/flags/{{ country }}.png" class="{% if country != 'lidarts' -%}country-flag{% endif -%}">{% endif %}
                    
                </h3>
            </div>
        </div>
    </div>

    <div class="col-auto mb-3">
        <div class="card bg-light text-dark">
            <div class="card-body">
                <h3 class="card-text">
                    {% if current_user.id == user.id %}
                    <a href="{{ url_for('profile.general_settings') }}" class="btn btn-secondary" role="button"><i class="fas fa-cog"></i> {{ _('Preferences') }}</a>       
                    {% else %}
                    <button class="btn btn-secondary" role="button" id="send_friend_request">
                        <i class="fas fa-user-friends"></i> {{ _('Friend request') }}
                    </button>       
                    <a href="{{ url_for('game.create', opponent_name=user.username) }}" class="btn btn-secondary" role="button"><i class="fas fa-dice"></i> {{ _('Challenge to game') }}</a>
                    {% endif %}
                </h3>
            </div>
        </div>
    </div>


</div>

<div class="row justify-content-center">
    <div class="col-12 col-lg-6 col-xl-4">
        <div class="card bg-light text-dark bs-callout bs-callout-info">
            <div class="card-body">
                {% if profile_text %}
                {{ profile_text | safe }}
                {% else %}
                {{ user.username }} {{ _('has not entered a profile text yet.') }}
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-12 mt-2 col-md-6 mt-lg-0 col-xl-4">
        <div class="card bg-light text-dark  bs-callout bs-callout-warning">
            <div class="card-body">
                <h5 class="card-title"><i class="fas fa-history"></i> {{ _('Recent games') }}</h5>
                <hr>
                {% for game, player1_name, player2_name in games %}

                <p class="text-secondary"><a href="{{ url_for('game.start', hashid=game.hashid) }}"
                                             class="
                                             {%- if game.status == 'started' %}text-started
                                             {%- elif game.player1 != game.player2 and
                                                    ((game.player1 == user.id and game.p1_sets > game.p2_sets)
                                                    or (game.player2 == user.id and game.p2_sets > game.p1_sets))
                                             %}text-success
                                             {%- elif game.player1 != game.player2 and
                                                    ((game.player1 == user.id and game.p1_sets < game.p2_sets)
                                                    or (game.player2 == user.id and game.p2_sets < game.p1_sets))
                                             %}text-danger
                                             {%- elif game.p1_sets == game.p2_sets %}text-warning
                                             {%- else %}text-secondary
                                             {%- endif %}
                                                ">vs.
                    {%- if game.opponent_type.startswith('computer') %} Trainer {{ game.opponent_type[8:] }}
                    {%- elif game.player1 != user.id %} {{ player1_name }}
                    {%- elif game.player2 != user.id %} {{ player2_name }}
                    {%- else %} local guest{% endif %}
                    - {{ game.type }} {{ game.in_mode }}/{{ game.out_mode }} [{{ game.p1_sets }}:{{ game.p2_sets }}, {{ game.p1_legs }}:{{ game.p2_legs }}]</a></p>
                {% endfor %}
                <a href="{{ url_for('profile.game_history', username=user.username) | replace('%40', '@') }}" class="text-secondary">{{ _('Full match list') }}</a>

            </div>
        </div>
    </div>


    <div class="col-12 mt-2 col-md-6 col-xl-4 mt-xl-0">
        <div class="card bg-light bs-callout bs-callout-danger text-secondary">
            <div class="card-body">
                <h5 class="card-title text-dark"><i class="fas fa-chart-bar"></i> {{ _('Statistics (501 SI/DO)') }}</h5>
                <hr>
                <p>{{ _('Number of games:') }} {{ stats.total_games }}</p>
                <p>{{ _('Darts thrown:') }} {{ stats.darts_thrown }}</p>
                <p>Average: {{ stats.average}}</p>
                <p>First 9: {{ stats.first9 }}</p>
                <p>Doubles: {{ stats.doubles }}%</p>

            </div>
        </div>
        {% if current_user.id == user.id %}
        <br>
        <div class="card bg-light bs-callout bs-callout-danger text-secondary">
            <div class="card-body">
                <h5 class="card-title text-dark"><i class="fas fa-chart-bar"></i> {{ _('Statistics') }}</h5>
                <p><a href="{{ url_for('statistics.x01') }}" class="text-secondary">{{ _('X01') }}</a></p>
            </div>
        </div>
        {% endif %}
    </div>
</div>




{% endblock %}


{% block scripts %}
<meta id="send_request_url" data-url="{{ url_for('generic.send_friend_request') }}">
<meta id="accept_url" data-url="{{ url_for('generic.accept_friend_request') }}">
<meta id="decline_url" data-url="{{ url_for('generic.decline_friend_request') }}">
<meta id="decline_challenge_url" data-url="{{ url_for('game.decline_challenge') }}">
<meta id="profile_user_id" data-id="{{ user.id }}">


<script type="text/javascript" src="{{ url_for('static',filename='js/friend_requests.js', version=config.VERSION) }}"></script>
{% endblock %}
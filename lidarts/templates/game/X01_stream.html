{% extends "base.html" %}
{% block title %}X01{% endblock %}
{% block css %}<link href="{{ url_for('static',filename='css/x01.css') }}" rel="stylesheet">{% endblock %}

{% block navbar %}
<div class="container-fluid">
    <div class="row mb-2">
        <div id="hide-keypad">Toggle Keypad</div><a href="{{ url_for('generic.index') }}">Index</a>
    </div>
</div>
{% endblock %}

{% block app_content %}


<div class="row justify-content-center align-items-center mb-3">
    <div class="col-12">
        <table class="table table-sm bg-dark text-light stats-table text-center" style="table-layout: fixed; width: 500px">
            <tr class="">
                <td class="" style="width: 50px;"></td>
                <td class="text-left border border-right-0 border-secondary" style="{% if game.bo_sets > 1 %}width: 210px;{% else %}width: 280px;{% endif %}"><h4>Best of {% if game.bo_sets == 1 %}{{ game.bo_legs }}
                    {% else %}{{ game.bo_sets }}{% endif %}</h4></td>
                <td class="border border-right-0 border-secondary" style="width: 70px; {% if game.bo_sets == 1 %}display:none;{% endif %}"><h4>Sets</h4></td>
                <td class="border border-secondary" style="width: 70px;"><h4>Legs</h4></td>
                <td style="width: 70px;"></td>
                <td style="width: 30px;"></td>
            </tr>
            <tr class="">
                <td class="font-weight-bold text-secondary align-middle"><h5 class="p1_darts_this_leg"></h5></td>
                <td class="bg-light text-dark border border-secondary text-left"><h3>{{ game.player1_name }}</h3></td>
                <td class="bg-danger border border-secondary" {% if game.bo_sets == 1 %}style="display:none;"{% endif %}><h3 class="p1_sets"></h3></td>
                <td class="bg-danger border border-secondary"><h3 class="p1_legs"></h3></td>
                <td class="bg-danger border border-secondary"><h3 class="p1_score" id="p1_score"></h3></td>
                <td class=""><h3 class="p1_turn_incidator"></h3></td>
            </tr>
            <tr class="">
                <td class="font-weight-bold text-secondary align-middle"><h5 class="p2_darts_this_leg"></h5></td>
                <td class="bg-light text-dark border border-secondary text-left"><h3>{{ game.player2_name }}</h3></td>
                <td class="bg-danger border border-secondary" {% if game.bo_sets == 1 %}style="display:none;"{% endif %}><h3 class="p2_sets"></h3></td>
                <td class="bg-danger border border-secondary"><h3 class="p2_legs"></h3></td>
                <td class="bg-danger border border-secondary"><h3 class="p2_score" id="p2_score"></h3></td>
                <td class=""><h3 class="p2_turn_incidator"></h3></td>
            </tr>
        </table>
    </div>
</div>


{% if game.closest_to_bull %}
<div class="row text-light  text-center mt-2" id="closest_to_bull_notification_div">
    <div class="col-12">
        <h3 id="closest_to_bull_notification">Closest to bull begins. Please throw three darts at bull.</h3>
        {% if game.player1 == game.player2 %}<h5>Local game. Player 1 throws all three darts first.</h5>{% endif %}
    </div>
</div>
{% endif %}


<div class="row justify-content-center align-items-start">
    <!-- SCOREBOARD PLAYER 1 -->
    <div class="col-lg-4 col-md-4 col-6 mt-3" id="p1_current_leg">
    </div>

    <!-- ONSCREEN KEYBOARD AND INPUT FIELD -->
    <div class="col-lg-3 col-md-4 mt-3 d-none d-md-block">

        <form class="text-center score_input" id="score_input" method="POST" action="" autocomplete="off" {% if game.status == 'completed' or not (current_user.id == game.player1 or current_user.id == game.player2) %} style="display: none" {% endif %}>
        {{ form.hidden_tag() }}
        <div class="col-xl-6 offset-xl-3 col-lg-8 offset-lg-2 col-md-10 offset-md-1 d-flex align-items-center mb-2">
            {{ form.score_value(class="bg-light text-center form-control form-control-lg border-secondary score_value",
            style="font-size: 35px; padding-top: 1px; padding-bottom: 1px; padding-left: 1px; padding-right: 1px;") }}
        </div>
        <div id="input-keypad">
            <div class="btn-group d-flex" role="group" aria-label="Basic example">
                <button type="button" id="button-1" class="button-1 btn btn-xl btn-secondary w-100 rounded-0 btn-rnd-tl">1</button>
                <button type="button" id="button-2" class="button-2 btn btn-xl btn-secondary w-100">2</button>
                <button type="button" id="button-3" class="button-3 btn btn-xl btn-secondary w-100 rounded-0 btn-rnd-tr">3</button>
            </div>
            <div class="btn-group d-flex" role="group" aria-label="Basic example">
                <button type="button" id="button-4" class="button-4 btn btn-xl btn-secondary w-100 rounded-0">4</button>
                <button type="button" id="button-5" class="button-5 btn btn-xl btn-secondary w-100">5</button>
                <button type="button" id="button-6" class="button-6 btn btn-xl btn-secondary w-100 rounded-0">6</button>
            </div>
            <div class="btn-group d-flex" role="group" aria-label="Basic example">
                <button type="button" id="button-7" class="button-7 btn btn-xl btn-secondary w-100 rounded-0">7</button>
                <button type="button" id="button-8" class="button-8 btn btn-xl btn-secondary w-100">8</button>
                <button type="button" id="button-9" class="button-9 btn btn-xl btn-secondary w-100 rounded-0">9</button>
            </div>
            <div class="btn-group d-flex" role="group" aria-label="Basic example">
                <button type="button" id="button-del" class="button-del btn btn-xl btn-danger w-100 rounded-0 btn-rnd-bl" style="font-size: 25px;"><i class="fas fa-times-circle" ></i></button>
                <button type="button" id="button-0" class="button-0 btn btn-xl btn-secondary w-100">0</button>
                <button type="button" id="button-conf" class="button-conf btn btn-xl btn-success w-100 rounded-0 btn-rnd-br" style="font-size: 25px;"><i class="fas fa-check-circle" ></i></button>
            </div>
        </div>

        </form>
        <!-- GAME END CONFIRMATION -->
        <form class="text-center confirm_completion" id="confirm_completion" method="POST" action="" {% if game.status != 'completed' %} style="display: none" {% endif %}>
            <h4 class="text-light">Game is completed.</h4>
            <a href="{{ url_for('game.start', hashid=game.hashid) }}">Game overview</a>
        </form>


    </div>

    <!-- SCOREBOARD PLAYER 2 -->
    <div class="col-lg-4 col-md-4 col-6 mt-3">
        <p id="p2_current_leg"></p>
    </div>
</div>

<!-- GAME END CONFIRMATION SMALL -->
<div class="col-sm-12 justify-content-center d-md-none confirm_completion" {% if game.status != 'completed' %} style="display: none" {% endif %}>
    <h4 class="text-light">Game is completed.</h4>
    <a href="{{ url_for('game.start', hashid=game.hashid) }}">Game overview</a>
</div>


<!-- STATISTICS -->
<div class="row fixed-bottom">
    <div class="container">
        <div class="row bg-secondary text-light">
            <div class="col-lg-2 d-none d-lg-block">
                <table class="table table-sm stats-table">
                    <tr>
                        <td>Leg Avg.</td>
                        <td class="p1_leg_avg font-weight-bold">{{ p1_leg_avg }}</td>
                    </tr>
                    <tr>
                        <td>Match Avg.</td>
                        <td class="p1_match_avg font-weight-bold">{{ p1_match_avg }}</td>
                    </tr>
                    <tr>
                        <td>First 9</td>
                        <td class="p1_first9_avg font-weight-bold">{{ p1_first9_avg }}</td>
                    </tr>
                </table>
            </div>
            <div class="col-lg-1 d-none d-lg-block">
                <table class="table table-sm stats-table">
                    <tr>
                        <td>100+</td>
                        <td class="p1_100 font-weight-bold">{{ p1_100 }}</td>
                    </tr>
                    <tr>
                        <td>140+</td>
                        <td class="p1_140 font-weight-bold">{{ p1_140 }}</td>
                    </tr>
                    <tr>
                        <td>180</td>
                        <td class="p1_180 font-weight-bold">{{ p1_180 }}</td>
                    </tr>
                </table>
            </div>
            <div class="col-lg-3 d-none d-lg-block">
                <table class="table table-sm stats-table">
                    <tr>
                        <td>Doubles</td>
                        <td class="p1_doubles font-weight-bold">{{ p1_doubles }}% ({{ p1_legs_won }}/{{ p1_darts_thrown_double }})</td>
                    </tr>
                    <tr>
                        <td>High Finish</td>
                        <td class="p1_high_finish font-weight-bold">{{ p1_high_finish }}</td>
                    </tr>
                    <tr>
                        <td>Short Leg</td>
                        <td class="p1_short_leg font-weight-bold">{{ p1_short_leg }}</td>
                    </tr>
                </table>
            </div>
            <div class="col-lg-2 d-none d-lg-block">
                <table class="table table-sm stats-table">
                    <tr>
                        <td>Leg Avg.</td>
                        <td class="p2_leg_avg font-weight-bold">{{ p2_leg_avg }}</td>
                    </tr>
                    <tr>
                        <td>Match Avg.</td>
                        <td class="p2_match_avg font-weight-bold">{{ p2_match_avg }}</td>
                    </tr>
                    <tr>
                        <td>First 9</td>
                        <td class="p2_first9_avg font-weight-bold">{{ p2_first9_avg }}</td>
                    </tr>
                </table>
            </div>
            <div class="col-lg-1 d-none d-lg-block">
                <table class="table table-sm stats-table">
                    <tr>
                        <td>100+</td>
                        <td class="p2_100 font-weight-bold">{{ p2_100 }}</td>
                    </tr>
                    <tr>
                        <td>140+</td>
                        <td class="p2_140 font-weight-bold">{{ p2_140 }}</td>
                    </tr>
                    <tr>
                        <td>180</td>
                        <td class="p2_180 font-weight-bold">{{ p2_180 }}</td>
                    </tr>
                </table>
            </div>
            <div class="col-lg-3 d-none d-lg-block">
                <table class="table table-sm stats-table">
                    <tr>
                        <td>Doubles</td>
                        <td class="p2_doubles font-weight-bold">{{ p2_doubles }}% ({{ p2_legs_won }}/{{ p2_darts_thrown_double }})</td>
                    </tr>
                    <tr>
                        <td>High Finish</td>
                        <td class="p2_high_finish font-weight-bold">{{ p2_high_finish }}</td>
                    </tr>
                    <tr>
                        <td>Short Leg</td>
                        <td class="p2_short_leg font-weight-bold">{{ p2_short_leg }}</td>
                    </tr>
                </table>
            </div>

        </div>
    </div>
</div>


<!-- ONSCREEN KEYBOARD SMALL SCREENS -->
<div class="row fixed-bottom">

    <div class="col-sm-12 d-md-none score_input">

        <div class="col-xl-6 offset-xl-3 col-lg-8 offset-lg-2 col-md-10 offset-md-1 d-flex align-items-center">
            <input class="bg-light text-center form-control form-control-lg border-secondary score_value" id="score_value_sm"
                   style="font-size: 35px; padding-top: 1px; padding-bottom: 1px; padding-left: 1px; padding-right: 1px;" readonly>
        </div>
        <div id="input-keypad1">
            <div class="btn-group d-flex" role="group" aria-label="Basic example">
                <button type="button" id="button-sm-1" class="button-1 btn btn-xl btn-secondary w-100 rounded-0">1</button>
                <button type="button" id="button-sm-2" class="button-2 btn btn-xl btn-secondary w-100">2</button>
                <button type="button" id="button-sm-3" class="button-3 btn btn-xl btn-secondary w-100 rounded-0">3</button>
            </div>
            <div class="btn-group d-flex" role="group" aria-label="Basic example">
                <button type="button" id="button-sm-4" class="button-4 btn btn-xl btn-secondary w-100 rounded-0">4</button>
                <button type="button" id="button-sm-5" class="button-5 btn btn-xl btn-secondary w-100">5</button>
                <button type="button" id="button-sm-6" class="button-6 btn btn-xl btn-secondary w-100 rounded-0">6</button>
            </div>
            <div class="btn-group d-flex" role="group" aria-label="Basic example">
                <button type="button" id="button-sm-7" class="button-7 btn btn-xl btn-secondary w-100 rounded-0">7</button>
                <button type="button" id="button-sm-8" class="button-8 btn btn-xl btn-secondary w-100">8</button>
                <button type="button" id="button-sm-9" class="button-9 btn btn-xl btn-secondary w-100 rounded-0">9</button>
            </div>
            <div class="btn-group d-flex" role="group" aria-label="Basic example">
                <button type="button" id="button-sm-del" class="button-del btn btn-xl btn-danger w-100 rounded-0" style="font-size: 25px;"><i class="fas fa-times-circle" ></i></button>
                <button type="button" id="button-sm-0" class="button-0 btn btn-xl btn-secondary w-100">0</button>
                <button type="button" id="button-sm-conf" class="button-conf btn btn-xl btn-success w-100 rounded-0" style="font-size: 25px;"><i class="fas fa-check-circle" ></i></button>
            </div>
        </div>
    </div>
</div>

<!-- GAME SHOT OVERLAY -->
<div class="modal fade game-shot-modal" id="game-shot-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content">
            <h2 class="text-center">Game Shot</h2>
        </div>
    </div>
</div>

<!-- MATCH SHOT OVERLAY -->
<div class="modal fade match-shot-modal" id="match-shot-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content">
            <h2 class="text-center">Game Shot and the match</h2>
        </div>
    </div>
</div>

<!-- MISSED AT DOUBLE OVERLAY -->
<div class="modal fade" id="double-missed-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <h4 class="text-center">How many darts missed at double?</h4>
            <button type="button" class="btn btn-primary double-missed-3" data-dismiss="modal" id="double-missed-3">3</button>
            <button type="button" class="btn btn-primary double-missed-2" data-dismiss="modal" id="double-missed-2">2</button>
            <button type="button" class="btn btn-primary double-missed-1" data-dismiss="modal" id="double-missed-1">1</button>
            <button type="button" class="btn btn-primary double-missed-0" data-dismiss="modal" id="double-missed-0">0</button>
        </div>
    </div>
</div>

<!-- DARTS TO FINISH OVERLAY -->
<div class="modal fade" id="darts-to-finish-modal" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <h4 class="text-center">How many darts to finish?</h4>
            <button type="button" class="btn btn-primary" data-dismiss="modal" id="to-finish-3">3</button>
            <button type="button" class="btn btn-primary" data-dismiss="modal" id="to-finish-2">2</button>
            <button type="button" class="btn btn-primary" data-dismiss="modal" id="to-finish-1">1</button>
        </div>
    </div>
</div>

{% endblock %}

{% block footer %}
{% endblock %}

{% block scripts %}
<meta id="hash_id" data-hashid="{{ game.hashid }}">
<meta id="validation_url" data-url="{{ url_for('game.validate_score') }}">
<meta id="user_id" data-id="{{ current_user.id }}">

{% if current_user.id == game.player1 or current_user.id == game.player2 %}
<script type="text/javascript" src="/static/js/x01_socket.js"></script>
{% else %}
<script type="text/javascript" src="/static/js/x01_spectator_socket.js"></script>
{% endif %}
{% endblock %}
